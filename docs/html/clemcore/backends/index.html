<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
<meta name="generator" content="pdoc3 0.11.6">
<title>clemcore.backends API documentation</title>
<meta name="description" content="">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/sanitize.min.css" integrity="sha512-y1dtMcuvtTMJc1yPgEqF0ZjQbhnc/bFhyvIyVNb9Zk5mIGtqVaAB1Ttl28su8AvFMOY0EwRbAe+HCLqj6W7/KA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/typography.min.css" integrity="sha512-Y1DYSb995BAfxobCkKepB1BqJJTPrOp3zPL74AWFugHHmmdcvO+C48WLrUOlhGMc0QG7AE3f7gmvvcrmX2fDoA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:1.5em;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:2em 0 .50em 0}h3{font-size:1.4em;margin:1.6em 0 .7em 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .2s ease-in-out}a:visited{color:#503}a:hover{color:#b62}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900;font-weight:bold}pre code{font-size:.8em;line-height:1.4em;padding:1em;display:block}code{background:#f3f3f3;font-family:"DejaVu Sans Mono",monospace;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source > summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible;min-width:max-content}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em 1em;margin:1em 0}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul ul{padding-left:1em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js" integrity="sha512-D9gUyxqja7hBtkWpPWGt9wfbfaMGVt9gnyCvYa+jojwwPHLCzUm5i8rpk7vD7wNee9bA35eYIjobYPaQuKS1MQ==" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => {
hljs.configure({languages: ['bash', 'css', 'diff', 'graphql', 'ini', 'javascript', 'json', 'plaintext', 'python', 'python-repl', 'rust', 'shell', 'sql', 'typescript', 'xml', 'yaml']});
hljs.highlightAll();
/* Collapse source docstrings */
setTimeout(() => {
[...document.querySelectorAll('.hljs.language-python > .hljs-string')]
.filter(el => el.innerHTML.length > 200 && ['"""', "'''"].includes(el.innerHTML.substring(0, 3)))
.forEach(el => {
let d = document.createElement('details');
d.classList.add('hljs-string');
d.innerHTML = '<summary>"""</summary>' + el.innerHTML.substring(3);
el.replaceWith(d);
});
}, 100);
})</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>clemcore.backends</code></h1>
</header>
<section id="section-intro">
</section>
<section>
<h2 class="section-title" id="header-submodules">Sub-modules</h2>
<dl>
<dt><code class="name"><a title="clemcore.backends.alephalpha_api" href="alephalpha_api.html">clemcore.backends.alephalpha_api</a></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt><code class="name"><a title="clemcore.backends.anthropic_api" href="anthropic_api.html">clemcore.backends.anthropic_api</a></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt><code class="name"><a title="clemcore.backends.cohere_api" href="cohere_api.html">clemcore.backends.cohere_api</a></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt><code class="name"><a title="clemcore.backends.google_api" href="google_api.html">clemcore.backends.google_api</a></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt><code class="name"><a title="clemcore.backends.huggingface_local_api" href="huggingface_local_api.html">clemcore.backends.huggingface_local_api</a></code></dt>
<dd>
<div class="desc"><p>Backend using HuggingFace transformers models.
Uses HF tokenizers instruct/chat templates for proper input format per model.</p></div>
</dd>
<dt><code class="name"><a title="clemcore.backends.huggingface_multimodal_api" href="huggingface_multimodal_api.html">clemcore.backends.huggingface_multimodal_api</a></code></dt>
<dd>
<div class="desc"><p>Backend using HuggingFace transformers for open-weight multimodal models.</p></div>
</dd>
<dt><code class="name"><a title="clemcore.backends.initial_hf_check" href="initial_hf_check.html">clemcore.backends.initial_hf_check</a></code></dt>
<dd>
<div class="desc"><p>Initial checks on models to be added to the HuggingFace local backend.</p></div>
</dd>
<dt><code class="name"><a title="clemcore.backends.llamacpp_api" href="llamacpp_api.html">clemcore.backends.llamacpp_api</a></code></dt>
<dd>
<div class="desc"><p>Backend using llama.cpp for GGUF/GGML models.</p></div>
</dd>
<dt><code class="name"><a title="clemcore.backends.mistral_api" href="mistral_api.html">clemcore.backends.mistral_api</a></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt><code class="name"><a title="clemcore.backends.model_registry" href="model_registry.html">clemcore.backends.model_registry</a></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt><code class="name"><a title="clemcore.backends.model_registry_eos_check" href="model_registry_eos_check.html">clemcore.backends.model_registry_eos_check</a></code></dt>
<dd>
<div class="desc"><p>Script to check model registry entries for regEx in EOS culling strings.
Run this script after adding new model entries for the HuggingFace, llama-cpp …</p></div>
</dd>
<dt><code class="name"><a title="clemcore.backends.multimodal_utils" href="multimodal_utils.html">clemcore.backends.multimodal_utils</a></code></dt>
<dd>
<div class="desc"><p>Util functions for multimodal models.</p></div>
</dd>
<dt><code class="name"><a title="clemcore.backends.openai_api" href="openai_api.html">clemcore.backends.openai_api</a></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt><code class="name"><a title="clemcore.backends.openai_compatible_api" href="openai_compatible_api.html">clemcore.backends.openai_compatible_api</a></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt><code class="name"><a title="clemcore.backends.utils" href="utils.html">clemcore.backends.utils</a></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt><code class="name"><a title="clemcore.backends.vllm_api" href="vllm_api.html">clemcore.backends.vllm_api</a></code></dt>
<dd>
<div class="desc"><p>Backend wrapping vLLM.
Uses HF tokenizers instruct/chat templates for proper input format per model.</p></div>
</dd>
</dl>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="clemcore.backends.is_backend"><code class="name flex">
<span>def <span class="ident">is_backend</span></span>(<span>obj)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def is_backend(obj):
    &#34;&#34;&#34;Check if an object is a Backend child class (instance).
    Args:
        obj: The object to be checked.
    Returns:
        True if the object is a Backend child class (instance); False otherwise.
    &#34;&#34;&#34;
    if inspect.isclass(obj) and issubclass(obj, Backend) and obj is not Backend:
        return True
    return False</code></pre>
</details>
<div class="desc"><p>Check if an object is a Backend child class (instance).</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>obj</code></strong></dt>
<dd>The object to be checked.</dd>
</dl>
<h2 id="returns">Returns</h2>
<p>True if the object is a Backend child class (instance); False otherwise.</p></div>
</dd>
<dt id="clemcore.backends.is_backend_file"><code class="name flex">
<span>def <span class="ident">is_backend_file</span></span>(<span>file_name: str)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def is_backend_file(file_name: str):
    return file_name.endswith(&#34;_api.py&#34;)</code></pre>
</details>
<div class="desc"></div>
</dd>
<dt id="clemcore.backends.load_credentials"><code class="name flex">
<span>def <span class="ident">load_credentials</span></span>(<span>backend, file_name='key.json') ‑> Dict</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def load_credentials(backend, file_name=&#34;key.json&#34;) -&gt; Dict:
    &#34;&#34;&#34;Load login credentials and API keys from JSON file.
    Args:
        backend: Name of the backend/API provider to load key for.
        file_name: Name of the key file.
    Returns:
        Dictionary with {backend: {api_key: key}}.
    &#34;&#34;&#34;

    key_file = os.path.join(os.getcwd(), file_name)
    try:  # first, optional location at cwd
        with open(key_file) as f:
            creds = json.load(f)
    except:  # second, look into user home app dir
        key_file = os.path.join(os.path.expanduser(&#34;~&#34;), &#34;.clemcore&#34;, file_name)
        with open(key_file) as f:
            creds = json.load(f)
    assert backend in creds, f&#34;No &#39;{backend}&#39; in {file_name}. See README.&#34;
    assert &#34;api_key&#34; in creds[backend], f&#34;No &#39;api_key&#39; in {file_name}. See README.&#34;
    return creds</code></pre>
</details>
<div class="desc"><p>Load login credentials and API keys from JSON file.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>backend</code></strong></dt>
<dd>Name of the backend/API provider to load key for.</dd>
<dt><strong><code>file_name</code></strong></dt>
<dd>Name of the key file.</dd>
</dl>
<h2 id="returns">Returns</h2>
<p>Dictionary with {backend: {api_key: key}}.</p></div>
</dd>
<dt id="clemcore.backends.to_backend_name"><code class="name flex">
<span>def <span class="ident">to_backend_name</span></span>(<span>file_name: str)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def to_backend_name(file_name: str):
    return file_name.replace(&#34;_api.py&#34;, &#34;&#34;)</code></pre>
</details>
<div class="desc"></div>
</dd>
</dl>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="clemcore.backends.Backend"><code class="flex name class">
<span>class <span class="ident">Backend</span></span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class Backend(abc.ABC):
    &#34;&#34;&#34;Abstract base class for clembench backends.
    All clembench backend classes must be child classes of this base class.&#34;&#34;&#34;

    @abc.abstractmethod
    def get_model_for(self, model_spec: ModelSpec) -&gt; Model:
        &#34;&#34;&#34;Get a Model instance for the model specific by ModelSpec.
        Must be implemented by every clembench backend.
        Args:
            model_spec: A ModelSpec instance specifying the model to return a corresponding Model child class instance
                for the appropriate backend.
        Returns:
            A Model instance using the appropriate backend.
        &#34;&#34;&#34;
        pass

    def __repr__(self):
        &#34;&#34;&#34;Get a string representation of this Backend instance.&#34;&#34;&#34;
        return str(self)

    def __str__(self):
        &#34;&#34;&#34;Get a string name of the class of this Backend child class instance.&#34;&#34;&#34;
        return f&#34;{self.__class__.__name__}&#34;</code></pre>
</details>
<div class="desc"><p>Abstract base class for clembench backends.
All clembench backend classes must be child classes of this base class.</p></div>
<h3>Ancestors</h3>
<ul class="hlist">
<li>abc.ABC</li>
</ul>
<h3>Subclasses</h3>
<ul class="hlist">
<li><a title="clemcore.backends.CustomResponseModelBackend" href="#clemcore.backends.CustomResponseModelBackend">CustomResponseModelBackend</a></li>
<li><a title="clemcore.backends.HumanModelBackend" href="#clemcore.backends.HumanModelBackend">HumanModelBackend</a></li>
<li><a title="clemcore.backends.alephalpha_api.AlephAlpha" href="alephalpha_api.html#clemcore.backends.alephalpha_api.AlephAlpha">AlephAlpha</a></li>
<li><a title="clemcore.backends.anthropic_api.Anthropic" href="anthropic_api.html#clemcore.backends.anthropic_api.Anthropic">Anthropic</a></li>
<li><a title="clemcore.backends.cohere_api.Cohere" href="cohere_api.html#clemcore.backends.cohere_api.Cohere">Cohere</a></li>
<li><a title="clemcore.backends.google_api.Google" href="google_api.html#clemcore.backends.google_api.Google">Google</a></li>
<li><a title="clemcore.backends.huggingface_local_api.HuggingfaceLocal" href="huggingface_local_api.html#clemcore.backends.huggingface_local_api.HuggingfaceLocal">HuggingfaceLocal</a></li>
<li><a title="clemcore.backends.huggingface_multimodal_api.HuggingfaceMultimodal" href="huggingface_multimodal_api.html#clemcore.backends.huggingface_multimodal_api.HuggingfaceMultimodal">HuggingfaceMultimodal</a></li>
<li><a title="clemcore.backends.llamacpp_api.LlamaCPPLocal" href="llamacpp_api.html#clemcore.backends.llamacpp_api.LlamaCPPLocal">LlamaCPPLocal</a></li>
<li><a title="clemcore.backends.mistral_api.Mistral" href="mistral_api.html#clemcore.backends.mistral_api.Mistral">Mistral</a></li>
<li><a title="clemcore.backends.openai_api.OpenAI" href="openai_api.html#clemcore.backends.openai_api.OpenAI">OpenAI</a></li>
<li><a title="clemcore.backends.openai_compatible_api.GenericOpenAI" href="openai_compatible_api.html#clemcore.backends.openai_compatible_api.GenericOpenAI">GenericOpenAI</a></li>
<li><a title="clemcore.backends.vllm_api.VLLMLocal" href="vllm_api.html#clemcore.backends.vllm_api.VLLMLocal">VLLMLocal</a></li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="clemcore.backends.Backend.get_model_for"><code class="name flex">
<span>def <span class="ident">get_model_for</span></span>(<span>self,<br>model_spec: <a title="clemcore.backends.model_registry.ModelSpec" href="model_registry.html#clemcore.backends.model_registry.ModelSpec">ModelSpec</a>) ‑> <a title="clemcore.backends.model_registry.Model" href="model_registry.html#clemcore.backends.model_registry.Model">Model</a></span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@abc.abstractmethod
def get_model_for(self, model_spec: ModelSpec) -&gt; Model:
    &#34;&#34;&#34;Get a Model instance for the model specific by ModelSpec.
    Must be implemented by every clembench backend.
    Args:
        model_spec: A ModelSpec instance specifying the model to return a corresponding Model child class instance
            for the appropriate backend.
    Returns:
        A Model instance using the appropriate backend.
    &#34;&#34;&#34;
    pass</code></pre>
</details>
<div class="desc"><p>Get a Model instance for the model specific by ModelSpec.
Must be implemented by every clembench backend.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>model_spec</code></strong></dt>
<dd>A ModelSpec instance specifying the model to return a corresponding Model child class instance
for the appropriate backend.</dd>
</dl>
<h2 id="returns">Returns</h2>
<p>A Model instance using the appropriate backend.</p></div>
</dd>
</dl>
</dd>
<dt id="clemcore.backends.BackendRegistry"><code class="flex name class">
<span>class <span class="ident">BackendRegistry</span></span>
<span>(</span><span>backend_files: List)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class BackendRegistry:

    def __init__(self, backend_files: List):
        self._backends_files = backend_files
        # for now, special handling of mock and terminal inputs (should be rather integrated via backends)
        self._backends_files.append({
            &#34;backend&#34;: &#34;_player_human&#34;,
            &#34;file_name&#34;: &#34;_internal&#34;,
            &#34;file_path&#34;: &#34;_internal&#34;,
            &#34;lookup_source&#34;: &#34;packaged&#34;
        })
        self._backends_files.append({
            &#34;backend&#34;: &#34;_player_programmed&#34;,
            &#34;file_name&#34;: &#34;_internal&#34;,
            &#34;file_path&#34;: &#34;_internal&#34;,
            &#34;lookup_source&#34;: &#34;packaged&#34;
        })

    def __len__(self):
        return len(self._backends_files)

    def __iter__(self):
        return iter(self._backends_files)

    def is_supported(self, backend_name: str):
        for backend_file in self._backends_files:
            if backend_file[&#34;backend&#34;] == backend_name:
                return True
        return False

    def get_first_file_matching(self, backend_selector: str):
        for backend_file in self._backends_files:
            if backend_file[&#34;backend&#34;] == backend_selector:
                return backend_file
        raise ValueError(f&#34;No registered backend file found for selector={backend_selector}&#34;)

    @classmethod
    def from_packaged_and_cwd_files(cls) -&gt; &#34;BackendRegistry&#34;:
        &#34;&#34;&#34;
        Lookup _api.py files in the following locations:
        (1) Lookup in current working directory (relative to script execution)
        (2) Lookup in the packaged clemcore backends module
        Backends found in the (1) are favored over (2), that is listed before them to allow to &#39;overwrite&#39; them.
        :return: backend registry with file path to backends to be dynamically loaded
        &#34;&#34;&#34;
        backend_files = []
        for file in os.listdir():
            if is_backend_file(file):
                backend_files.append({&#34;backend&#34;: to_backend_name(file),
                                      &#34;file_name&#34;: file,
                                      &#34;file_path&#34;: os.path.join(os.getcwd(), file),
                                      &#34;lookup_source&#34;: &#34;cwd&#34;})
        for file in importlib_resources.files(__package__).iterdir():  # __package__ already points to &#34;backends&#34;
            if is_backend_file(file.name):
                backend_files.append({&#34;backend&#34;: to_backend_name(file.name),
                                      &#34;file_name&#34;: file.name,
                                      &#34;file_path&#34;: str(file),
                                      &#34;lookup_source&#34;: &#34;packaged&#34;})

        return cls(backend_files)

    def get_backend_for(self, backend_selector: str) -&gt; Backend:
        &#34;&#34;&#34;Dynamically loads the Backend from the first file that matches the name &lt;backend_selector&gt;_api.py.
        Raises an exception if no such file exists or the Backend class could not be found.
        Args:
            backend_selector: The &lt;backend_selector&gt; prefix of the &lt;backend_selector&gt;_api.py file.
        Returns:
            The Backend subclass for the passed backend name.
        Raises:
            FileNotFoundError: Will be raised if no backend python file with the passed name can be found in the backends
                directory.
            LookupError: Will be raised if the backend python file with the passed name does not contain exactly one Backend
                subclass.
        &#34;&#34;&#34;
        # for now, special handling of mock and terminal inputs (should be rather integrated via backends)
        if backend_selector == &#34;_player_human&#34;:
            return HumanModelBackend()
        if backend_selector == &#34;_player_programmed&#34;:
            return CustomResponseModelBackend()

        backend_file = self.get_first_file_matching(backend_selector)
        module_name, _ = os.path.splitext(backend_file[&#34;file_name&#34;])
        if backend_file[&#34;lookup_source&#34;] == &#34;packaged&#34;:
            # relative imports (sibling to __init__.py) require starting dot
            module = importlib.import_module(f&#34;.{module_name}&#34;, __package__)
        else:
            module_path = backend_file[&#34;file_path&#34;]
            spec = importlib_util.spec_from_file_location(module_name, module_path)
            module = importlib_util.module_from_spec(spec)
            spec.loader.exec_module(module)
        backend_subclasses = inspect.getmembers(module, predicate=is_backend)
        if len(backend_subclasses) == 0:
            raise LookupError(f&#34;There is no Backend defined in {module}. &#34;
                              f&#34;Create such a class and try again or &#34;
                              f&#34;check the backend selector &#39;{backend_selector}&#39;.&#34;)
        if len(backend_subclasses) &gt; 1:
            raise LookupError(f&#34;There is more than one Backend defined in {module}.&#34;)
        _, backend_cls = backend_subclasses[0]
        return backend_cls()</code></pre>
</details>
<div class="desc"></div>
<h3>Static methods</h3>
<dl>
<dt id="clemcore.backends.BackendRegistry.from_packaged_and_cwd_files"><code class="name flex">
<span>def <span class="ident">from_packaged_and_cwd_files</span></span>(<span>) ‑> <a title="clemcore.backends.BackendRegistry" href="#clemcore.backends.BackendRegistry">BackendRegistry</a></span>
</code></dt>
<dd>
<div class="desc"><p>Lookup _api.py files in the following locations:
(1) Lookup in current working directory (relative to script execution)
(2) Lookup in the packaged clemcore backends module
Backends found in the (1) are favored over (2), that is listed before them to allow to 'overwrite' them.
:return: backend registry with file path to backends to be dynamically loaded</p></div>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="clemcore.backends.BackendRegistry.get_backend_for"><code class="name flex">
<span>def <span class="ident">get_backend_for</span></span>(<span>self, backend_selector: str) ‑> <a title="clemcore.backends.Backend" href="#clemcore.backends.Backend">Backend</a></span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_backend_for(self, backend_selector: str) -&gt; Backend:
    &#34;&#34;&#34;Dynamically loads the Backend from the first file that matches the name &lt;backend_selector&gt;_api.py.
    Raises an exception if no such file exists or the Backend class could not be found.
    Args:
        backend_selector: The &lt;backend_selector&gt; prefix of the &lt;backend_selector&gt;_api.py file.
    Returns:
        The Backend subclass for the passed backend name.
    Raises:
        FileNotFoundError: Will be raised if no backend python file with the passed name can be found in the backends
            directory.
        LookupError: Will be raised if the backend python file with the passed name does not contain exactly one Backend
            subclass.
    &#34;&#34;&#34;
    # for now, special handling of mock and terminal inputs (should be rather integrated via backends)
    if backend_selector == &#34;_player_human&#34;:
        return HumanModelBackend()
    if backend_selector == &#34;_player_programmed&#34;:
        return CustomResponseModelBackend()

    backend_file = self.get_first_file_matching(backend_selector)
    module_name, _ = os.path.splitext(backend_file[&#34;file_name&#34;])
    if backend_file[&#34;lookup_source&#34;] == &#34;packaged&#34;:
        # relative imports (sibling to __init__.py) require starting dot
        module = importlib.import_module(f&#34;.{module_name}&#34;, __package__)
    else:
        module_path = backend_file[&#34;file_path&#34;]
        spec = importlib_util.spec_from_file_location(module_name, module_path)
        module = importlib_util.module_from_spec(spec)
        spec.loader.exec_module(module)
    backend_subclasses = inspect.getmembers(module, predicate=is_backend)
    if len(backend_subclasses) == 0:
        raise LookupError(f&#34;There is no Backend defined in {module}. &#34;
                          f&#34;Create such a class and try again or &#34;
                          f&#34;check the backend selector &#39;{backend_selector}&#39;.&#34;)
    if len(backend_subclasses) &gt; 1:
        raise LookupError(f&#34;There is more than one Backend defined in {module}.&#34;)
    _, backend_cls = backend_subclasses[0]
    return backend_cls()</code></pre>
</details>
<div class="desc"><p>Dynamically loads the Backend from the first file that matches the name <backend_selector>_api.py.
Raises an exception if no such file exists or the Backend class could not be found.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>backend_selector</code></strong></dt>
<dd>The <backend_selector> prefix of the <backend_selector>_api.py file.</dd>
</dl>
<h2 id="returns">Returns</h2>
<p>The Backend subclass for the passed backend name.</p>
<h2 id="raises">Raises</h2>
<dl>
<dt><code>FileNotFoundError</code></dt>
<dd>Will be raised if no backend python file with the passed name can be found in the backends
directory.</dd>
<dt><code>LookupError</code></dt>
<dd>Will be raised if the backend python file with the passed name does not contain exactly one Backend
subclass.</dd>
</dl></div>
</dd>
<dt id="clemcore.backends.BackendRegistry.get_first_file_matching"><code class="name flex">
<span>def <span class="ident">get_first_file_matching</span></span>(<span>self, backend_selector: str)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_first_file_matching(self, backend_selector: str):
    for backend_file in self._backends_files:
        if backend_file[&#34;backend&#34;] == backend_selector:
            return backend_file
    raise ValueError(f&#34;No registered backend file found for selector={backend_selector}&#34;)</code></pre>
</details>
<div class="desc"></div>
</dd>
<dt id="clemcore.backends.BackendRegistry.is_supported"><code class="name flex">
<span>def <span class="ident">is_supported</span></span>(<span>self, backend_name: str)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def is_supported(self, backend_name: str):
    for backend_file in self._backends_files:
        if backend_file[&#34;backend&#34;] == backend_name:
            return True
    return False</code></pre>
</details>
<div class="desc"></div>
</dd>
</dl>
</dd>
<dt id="clemcore.backends.ContextExceededError"><code class="flex name class">
<span>class <span class="ident">ContextExceededError</span></span>
<span>(</span><span>info_str: str = 'Context limit exceeded',<br>tokens_used: int = 0,<br>tokens_left: int = 0,<br>context_size: int = 0)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class ContextExceededError(Exception):
    &#34;&#34;&#34;Exception to be raised when the messages passed to a backend instance exceed the context limit of the model.&#34;&#34;&#34;
    tokens_used: int = int()
    tokens_left: int = int()
    context_size: int = int()

    def __init__(self, info_str: str = &#34;Context limit exceeded&#34;, tokens_used: int = 0,
                 tokens_left: int = 0, context_size: int = 0):
        &#34;&#34;&#34;
        Args:
            info_str: String informing about context limit being exceeded. To optionally be modified with further
                information by the backend class eventually raising this error.
            tokens_used: The number of tokens used by the context that lead to this error being raised.
            tokens_left: The number of tokens left in the context limit. Will be negative if this error is raised,
                absolute value being the number of tokens that exceed the context limit.
            context_size: The size of the context/the context limit.
        &#34;&#34;&#34;
        info = f&#34;{info_str} {tokens_used}/{context_size}&#34;
        super().__init__(info)
        self.tokens_used = tokens_used
        self.tokens_left = tokens_left
        self.context_size = context_size</code></pre>
</details>
<div class="desc"><p>Exception to be raised when the messages passed to a backend instance exceed the context limit of the model.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>info_str</code></strong></dt>
<dd>String informing about context limit being exceeded. To optionally be modified with further
information by the backend class eventually raising this error.</dd>
<dt><strong><code>tokens_used</code></strong></dt>
<dd>The number of tokens used by the context that lead to this error being raised.</dd>
<dt><strong><code>tokens_left</code></strong></dt>
<dd>The number of tokens left in the context limit. Will be negative if this error is raised,
absolute value being the number of tokens that exceed the context limit.</dd>
<dt><strong><code>context_size</code></strong></dt>
<dd>The size of the context/the context limit.</dd>
</dl></div>
<h3>Ancestors</h3>
<ul class="hlist">
<li>builtins.Exception</li>
<li>builtins.BaseException</li>
</ul>
<h3>Class variables</h3>
<dl>
<dt id="clemcore.backends.ContextExceededError.context_size"><code class="name">var <span class="ident">context_size</span> : int</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="clemcore.backends.ContextExceededError.tokens_left"><code class="name">var <span class="ident">tokens_left</span> : int</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="clemcore.backends.ContextExceededError.tokens_used"><code class="name">var <span class="ident">tokens_used</span> : int</code></dt>
<dd>
<div class="desc"></div>
</dd>
</dl>
</dd>
<dt id="clemcore.backends.CustomResponseModelBackend"><code class="flex name class">
<span>class <span class="ident">CustomResponseModelBackend</span></span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class CustomResponseModelBackend(Backend):

    def get_model_for(self, model_spec: ModelSpec) -&gt; Model:
        if model_spec.is_programmatic():
            return CustomResponseModel(model_spec)
        raise ValueError(f&#34;CustomResponseModelBackend cannot get model for {model_spec.to_string()}&#34;)</code></pre>
</details>
<div class="desc"><p>Abstract base class for clembench backends.
All clembench backend classes must be child classes of this base class.</p></div>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="clemcore.backends.Backend" href="#clemcore.backends.Backend">Backend</a></li>
<li>abc.ABC</li>
</ul>
<h3>Inherited members</h3>
<ul class="hlist">
<li><code><b><a title="clemcore.backends.Backend" href="#clemcore.backends.Backend">Backend</a></b></code>:
<ul class="hlist">
<li><code><a title="clemcore.backends.Backend.get_model_for" href="#clemcore.backends.Backend.get_model_for">get_model_for</a></code></li>
</ul>
</li>
</ul>
</dd>
<dt id="clemcore.backends.HumanModelBackend"><code class="flex name class">
<span>class <span class="ident">HumanModelBackend</span></span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class HumanModelBackend(Backend):

    def get_model_for(self, model_spec: ModelSpec) -&gt; Model:
        if model_spec.is_human():
            return HumanModel(model_spec)
        raise ValueError(f&#34;HumanModelBackend cannot get model for {model_spec.to_string()}&#34;)</code></pre>
</details>
<div class="desc"><p>Abstract base class for clembench backends.
All clembench backend classes must be child classes of this base class.</p></div>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="clemcore.backends.Backend" href="#clemcore.backends.Backend">Backend</a></li>
<li>abc.ABC</li>
</ul>
<h3>Inherited members</h3>
<ul class="hlist">
<li><code><b><a title="clemcore.backends.Backend" href="#clemcore.backends.Backend">Backend</a></b></code>:
<ul class="hlist">
<li><code><a title="clemcore.backends.Backend.get_model_for" href="#clemcore.backends.Backend.get_model_for">get_model_for</a></code></li>
</ul>
</li>
</ul>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="clemcore" href="../index.html">clemcore</a></code></li>
</ul>
</li>
<li><h3><a href="#header-submodules">Sub-modules</a></h3>
<ul>
<li><code><a title="clemcore.backends.alephalpha_api" href="alephalpha_api.html">clemcore.backends.alephalpha_api</a></code></li>
<li><code><a title="clemcore.backends.anthropic_api" href="anthropic_api.html">clemcore.backends.anthropic_api</a></code></li>
<li><code><a title="clemcore.backends.cohere_api" href="cohere_api.html">clemcore.backends.cohere_api</a></code></li>
<li><code><a title="clemcore.backends.google_api" href="google_api.html">clemcore.backends.google_api</a></code></li>
<li><code><a title="clemcore.backends.huggingface_local_api" href="huggingface_local_api.html">clemcore.backends.huggingface_local_api</a></code></li>
<li><code><a title="clemcore.backends.huggingface_multimodal_api" href="huggingface_multimodal_api.html">clemcore.backends.huggingface_multimodal_api</a></code></li>
<li><code><a title="clemcore.backends.initial_hf_check" href="initial_hf_check.html">clemcore.backends.initial_hf_check</a></code></li>
<li><code><a title="clemcore.backends.llamacpp_api" href="llamacpp_api.html">clemcore.backends.llamacpp_api</a></code></li>
<li><code><a title="clemcore.backends.mistral_api" href="mistral_api.html">clemcore.backends.mistral_api</a></code></li>
<li><code><a title="clemcore.backends.model_registry" href="model_registry.html">clemcore.backends.model_registry</a></code></li>
<li><code><a title="clemcore.backends.model_registry_eos_check" href="model_registry_eos_check.html">clemcore.backends.model_registry_eos_check</a></code></li>
<li><code><a title="clemcore.backends.multimodal_utils" href="multimodal_utils.html">clemcore.backends.multimodal_utils</a></code></li>
<li><code><a title="clemcore.backends.openai_api" href="openai_api.html">clemcore.backends.openai_api</a></code></li>
<li><code><a title="clemcore.backends.openai_compatible_api" href="openai_compatible_api.html">clemcore.backends.openai_compatible_api</a></code></li>
<li><code><a title="clemcore.backends.utils" href="utils.html">clemcore.backends.utils</a></code></li>
<li><code><a title="clemcore.backends.vllm_api" href="vllm_api.html">clemcore.backends.vllm_api</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="clemcore.backends.is_backend" href="#clemcore.backends.is_backend">is_backend</a></code></li>
<li><code><a title="clemcore.backends.is_backend_file" href="#clemcore.backends.is_backend_file">is_backend_file</a></code></li>
<li><code><a title="clemcore.backends.load_credentials" href="#clemcore.backends.load_credentials">load_credentials</a></code></li>
<li><code><a title="clemcore.backends.to_backend_name" href="#clemcore.backends.to_backend_name">to_backend_name</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="clemcore.backends.Backend" href="#clemcore.backends.Backend">Backend</a></code></h4>
<ul class="">
<li><code><a title="clemcore.backends.Backend.get_model_for" href="#clemcore.backends.Backend.get_model_for">get_model_for</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="clemcore.backends.BackendRegistry" href="#clemcore.backends.BackendRegistry">BackendRegistry</a></code></h4>
<ul class="">
<li><code><a title="clemcore.backends.BackendRegistry.from_packaged_and_cwd_files" href="#clemcore.backends.BackendRegistry.from_packaged_and_cwd_files">from_packaged_and_cwd_files</a></code></li>
<li><code><a title="clemcore.backends.BackendRegistry.get_backend_for" href="#clemcore.backends.BackendRegistry.get_backend_for">get_backend_for</a></code></li>
<li><code><a title="clemcore.backends.BackendRegistry.get_first_file_matching" href="#clemcore.backends.BackendRegistry.get_first_file_matching">get_first_file_matching</a></code></li>
<li><code><a title="clemcore.backends.BackendRegistry.is_supported" href="#clemcore.backends.BackendRegistry.is_supported">is_supported</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="clemcore.backends.ContextExceededError" href="#clemcore.backends.ContextExceededError">ContextExceededError</a></code></h4>
<ul class="">
<li><code><a title="clemcore.backends.ContextExceededError.context_size" href="#clemcore.backends.ContextExceededError.context_size">context_size</a></code></li>
<li><code><a title="clemcore.backends.ContextExceededError.tokens_left" href="#clemcore.backends.ContextExceededError.tokens_left">tokens_left</a></code></li>
<li><code><a title="clemcore.backends.ContextExceededError.tokens_used" href="#clemcore.backends.ContextExceededError.tokens_used">tokens_used</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="clemcore.backends.CustomResponseModelBackend" href="#clemcore.backends.CustomResponseModelBackend">CustomResponseModelBackend</a></code></h4>
</li>
<li>
<h4><code><a title="clemcore.backends.HumanModelBackend" href="#clemcore.backends.HumanModelBackend">HumanModelBackend</a></code></h4>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.11.6</a>.</p>
</footer>
</body>
</html>
